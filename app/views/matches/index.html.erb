<div id="fullpage">
    <% future_matches = find_future_matches(@matches)%>
    <% sorted_matches = sort_matches_by_date(future_matches) %>
    <% sorted_matches.each do |match| %>
      <% @home_team = Team.find(match.home_team_id) %>
      <% @away_team = Team.find(match.away_team_id) %>

      <div class="section fp-bg fp-noscroll">
        <!-- Makes gradient behind match up -->
        <div class="slide" style="background: #FFFFFF; background: -webkit-linear-gradient(to right, <%= @home_team.bright_color %>, <%= @away_team.bright_color %>);
        background: linear-gradient(to right, <%= @home_team.bright_color %>, <%= @away_team.bright_color %>);">

          <div class="container-fluid">

            <div class="row">
              <div class="col-xs-12 mx-auto">
                <div class="match-teams">
                  <h1 class="match-heading"> <%= @home_team.name %> vs. <%=  @away_team.name %> </h1>
                  <p class="match-info"> <%= match.venue.name %> <%= format_match_date(match) %> <span class="match-venue-timezone">(<%= match.venue.time_zone %>)</span> </p>
                </div>
              </div>
            </div>

            <div class="row justify-content-center">
              <div class="col-xs-12 mx-auto">
                <!-- Logic checking if a prediction has already been made for a certain match by the current user -->
                <% if current_user.predictions.select{|prediction| prediction.match_id == match.id}.empty?  %>
                  <h3 class="prediction-prompt text-center"> Which Team will Win? </h3>
                  <%= form_tag(controller:'predictions', action:'create') do %>

                    <div class="d-flex justify-content-around">
                      <!-- home -->
                      <div class="form-group form-check form-check-inline">
                        <%= label_tag :guess, "#{@home_team.abbreviation}", class: "form-check-label", style:"color:#{@home_team.dark_color}; font-weight:bold;"%>
                        <%= check_box_tag :guess, @home_team.name, false, class: "prediction-checkbox form-check-input" %>
                      </div>

                      <!-- tie -->
                      <div class="form-group form-check form-check-inline">
                          <%= label_tag :guess, "Tie", class: "form-check-label"%>
                          <%= check_box_tag :guess, "Tie", false, class: "prediction-checkbox form-check-input" %>
                      </div>

                      <!-- away -->
                      <div class="form-group form-check form-check-inline">
                        <%= label_tag :guess, "#{@away_team.abbreviation}", class: "form-check-label", style:"color:#{@away_team.dark_color}; font-weight:bold;"%>
                        <%= check_box_tag :guess, @away_team.name, false, class: "prediction-checkbox form-check-input" %>
                      </div>

                    </div>

                    <div class="reason-textbox d-flex justify-content-center">
                      <div class="reason-input form-group">
                        <%= text_area_tag :reason, nil, class:"form-control", maxlength:"200", placeholder: "Add Your Reason Why... " %>
                      </div>
                    </div>

                    <%= hidden_field_tag "user_id", current_user.id %>

                    <%= hidden_field_tag "match_id", match.id %>

                    <div class="form-actions prediction-submit">
                      <%= submit_tag "Submit", class: "btn btn-outline-light btn-md" %>
                    </div>


                  <% end %>

                <% else %>
                <div class="user-prediction-summary">
                  <h2 class="text-center user-prediction-title">Your Prediction:</h2>
                  <% user_prediction = current_user.predictions.find{|prediction| prediction.match_id == match.id} %>
                  <p class="user-predictions"> Your Guess: <span class="prediction-summary-text"><%= user_prediction.guess %> <span>
                  <p class="user-predictions"> Your Reasoning: <span class="prediction-summary-text"><%= user_prediction.reason %> <span>
                </div>
                <% end %>
                </div><!--End column-->
              </div> <!--End Row-->
            </div> <!--End container-->
          </div> <!--End make prediction slide-->

        <!-- All Predictions Slide -->
        <div class="slide big-black">
          <div class="container-fluid">
            <% home_predictions = select_team_predictions(match, @home_team) %>
            <% away_predictions = select_team_predictions(match, @away_team) %>
            <% tie_predictions = select_tie_predictions(match, "Tie") %>

            <div class="row">
              <div class="col-xs-12 mx-auto mt-4">
                <h1 class="match-heading"> <%= @home_team.name %> vs. <%=  @away_team.name %> </h1>
                <p class="match-info"> <%= match.start.to_date.strftime("%B #{match.start.to_date.day.ordinalize}") %>, <%= match.venue.name %> </p>
                <p> Total predictions for this match: <%= calculate_total_predictions(match).to_i %> </p>
              </div>
            </div>

            <!-- Home predictions -->
            <div class="row justify-content-around all-predictions">
              <div class="col-xs-12">
                <% number_of_home_predictions = home_predictions.count %>
                <% if number_of_home_predictions != 0 %>
                  <h2 class="prediction-board-header text-center"> <%= number_of_home_predictions %> <%= pluralize_prediction_statement(number_of_home_predictions) %> that <%= @home_team.name %> will win (<%= calculate_team_prediction_percentage(match, @home_team) %>) </h2>
                    <div class="match-leaderboard table-responsive">
                      <table class="table table-striped table-dark match-leaderboard-table">
                        <thead>
                          <tr>
                            <th scope="col" class="table-header">Username</th>
                            <th scope="col" class="table-header">Prediction</th>
                            <th scope="col" class="table-header">Reason</th>
                          </tr>
                        </thead>
                        <tbody>
                        <% home_predictions.each do |prediction| %>
                          <tr>
                            <td><%= prediction.user.username %></td>
                            <td><%= prediction.guess %> </td>
                            <td><%= prediction.reason %> </td>
                          </tr>
                        <% end %>
                        </tbody>
                      </table>
                    </div><!--End Match leaderboard wrapper-->
                <%else%>
                  <h2 class="prediction-board-header text-center"> <%= number_of_home_predictions %> <%= pluralize_prediction_statement(number_of_home_predictions) %> that <%= @home_team.name %> will win (<%= calculate_team_prediction_percentage(match, @home_team) %>) </h2>
                  <hr class="prediction-divider"/>
                <%end%>
                </div><!--End Home Predictions col-->
              </div> <!--End Home Predictions row-->

              <!-- Tie predictions -->
              <div class="row justify-content-around all-predictions">
                <div class="col-xs-12">

                  <% number_of_tie_predictions = tie_predictions.count %>
                  <% if number_of_tie_predictions != 0 %>
                    <h2 class="prediction-board-header text-center"> <%= number_of_tie_predictions %> <%= pluralize_prediction_statement(number_of_tie_predictions) %> that there will be a tie (<%= calculate_tie_prediction_percentage(match, "Tie") %> ) </h2>
                    <div class="match-leaderboard">
                      <table class="table table-striped table-dark match-leaderboard-table">
                        <thead>
                          <tr>
                            <th scope="col" class="table-header">Username</th>
                            <th scope="col" class="table-header">Prediction</th>
                            <th scope="col" class="table-header">Reason</th>
                          </tr>
                        </thead>
                        <tbody>
                        <% tie_predictions.each do |prediction| %>
                          <tr>
                            <td><%= prediction.user.username %></td>
                            <td><%= prediction.guess %> </td>
                            <td><%= prediction.reason %> </td>
                          </tr>
                        <% end %>
                        </tbody>
                      </table>
                    </div><!--End Match leaderboard wrapper-->
                  <%else%>
                    <h2 class="prediction-board-header text-center"> <%= number_of_tie_predictions %> <%= pluralize_prediction_statement(number_of_tie_predictions) %> that there will be a tie (<%= calculate_tie_prediction_percentage(match, "Tie") %> ) </h2>
                    <hr class="prediction-divider"/>
                <%end%>
              </div> <!--End Tie Predictions col -->
            </div> <!--End Tie Predictions row-->


                <!-- Away predictions -->
                <div class="row justify-content-around all-predictions">
                  <div class="col-xs-12">
                    <% number_of_away_predictions = away_predictions.count %>
                    <% if number_of_away_predictions != 0 %>
                      <h2 class="prediction-board-header text-center"> <%= number_of_away_predictions %> <%= pluralize_prediction_statement(number_of_away_predictions) %> that <%= @away_team.name %> will win (<%= calculate_team_prediction_percentage(match, @away_team) %>) </h2>
                      <div class="match-leaderboard">
                        <table class="table table-striped table-dark match-leaderboard-table">
                          <thead>
                            <tr>
                              <th scope="col" class="table-header">Username</th>
                              <th scope="col" class="table-header">Prediction</th>
                              <th scope="col" class="table-header">Reason</th>
                            </tr>
                          </thead>
                          <tbody>
                          <% away_predictions.each do |prediction| %>
                            <tr>
                              <td><%= prediction.user.username %></td>
                              <td><%= prediction.guess %> </td>
                              <td><%= prediction.reason %> </td>
                            </tr>
                          <% end %>
                          </tbody>
                        </table>
                      </div> <!--End match leaderbard wrapper-->
                <%else%>
                    <h2 class="prediction-board-header text-center"> <%= number_of_away_predictions %> <%= pluralize_prediction_statement(number_of_away_predictions) %> that <%= @away_team.name %> will win (<%= calculate_team_prediction_percentage(match, @away_team) %>) </h2>
                <%end%>
              </div> <!--End away predictions col-->
            </div> <!--End away predictions row-->
          </div> <!--End predictions slide container-->
        </div> <!--End predictions slide-->

        <!-- Venue Information -->
        <div class="slide big-black">
          <div class="container-fluid">

            <h2 class="venue-info-title text-center"> Venue Information: </h2>

            <div class="row justify-content-center">

              <div class="col-xs-12 mx-auto">

                <div>

                  <div class="venue-location-info">
                    <p class="venue-specs"><%=match.venue.name%> <br/><%=match.venue.address%></p>
                  </div>

                  <div class="match-date">
                      <p><%=format_match_date_english(match)%></p>
                  </div>

                  <div class="match-channel">
                    <p><%=match.channel%> </p>
                  </div>

                </div>

                <div class="countdown-text">
                  <h3 class="text-center coutdown-title"> Countdown to Game </h3>
                  <div id="clock" class="countdown mx-auto text-center" data-countdown="<%=match.start.strftime('%m/%d/%Y %I:%M:%S')%>"></div>
                </div>

                  <div class="venue-match-links">
                    <a class="game-reminder-link text-center" href="#">Remind Me when Game Starts!</a>
                    <a class="ticket-link text-center"href="http://www.nwslsoccer.com/tickets">Purchase Tickets</a>
                  </div>

                </div><!--End col -->

              </div> <!--End row -->

              <div class="row justify-content-center">
                <div class="col-xs-12">
                    <%= link_to image_tag("logos/bcd_black_blue_lg_rectangle2.jpg", class: "logo-link"), root_path %>
                </div>
              </div>

          </div> <!--End Venue Info contiainer-->
        </div> <!--End Venue Info Slide-->
      </div> <!-- End section template -->

    <% end %>
</div> <!-- End fullpage -->
